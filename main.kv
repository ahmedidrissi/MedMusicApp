#:kivy 2.1.0
#-------------------------------------------------------------------------------------------------------
<Playlist>
    size_hint_y: None
    height: dp(70)
    md_bg_color: app.theme_cls.bg_dark
    radius: 5
    elevation: 4

    TwoLineAvatarIconListItem:
        text: f"[b] {root.title} [/b]"
        secondary_text: "0 songs"
        pos_hint: {'center_y': .5}
        divider: None
        on_release: app.open_playlist(root.title)
        
        ImageLeftWidget:
            source: root.playlist_image
            radius: 5
            on_release: app.open_playlist(root.title)

        IconRightWidget:
            icon: "dots-vertical"
            on_release: app.show_playlist_bottom_sheet(root.title)
#-------------------------------------------------------------------------------------------------------  
<Add_Playlist_Dialog>
    orientation: "vertical"
    spacing: "12dp"
    size_hint_y: None
    height: dp(50)

    MDTextField:
        id: playlist_name_input
        hint_text: "Playlist name"
        mode: "rectangle"
        max_text_length: 20
        helper_text: "Enter your playlist name please"
#-------------------------------------------------------------------------------------------------------
<Rename_Playlist_Dialog>
    orientation: "vertical"
    spacing: "12dp"
    size_hint_y: None
    height: dp(50)

    MDTextField:
        id: playlist_newname_input
        hint_text: "Playlist name"
        mode: "rectangle"
        max_text_length: 20
        helper_text: "Enter your playlist name please"
#-------------------------------------------------------------------------------------------------------
<Song>
    size_hint_y: None
    height: dp(50)
    md_bg_color: app.theme_cls.bg_dark
    radius: 5
    elevation: 4

    OneLineAvatarIconListItem:
        text: root.title.split("\\")[-1][:-4]
        pos_hint: {'center_y': .5}
        divider: None
        on_release: app.set_song(root.title)
        
        IconLeftWidget:
            icon: "adjust"
            on_release: app.set_song(root.title)

        IconRightWidget:
            icon: "dots-vertical"
            on_release: app.show_song_bottom_sheet(root.title)
            disabled: True if app.first_screen == "AlbumsScreen" else False
#-------------------------------------------------------------------------------------------------------
<MusicPlayer>
    orientation: "vertical"
    md_bg_color: app.theme_cls.primary_color
    radius: 0

    MDBoxLayout:
        padding: dp(8)
        spacing: dp(8)

        MDIconButton:
            icon: "chevron-up"
            pos_hint: {"center_x": .5, "center_y": .5}
            on_release: app.show_expansed_music_player()
            theme_icon_color: "Custom"
            icon_color: 1,1,1,1

        MDLabel:
            text: app.running_song_title
            bold: True
            theme_text_color: "Custom"
            text_color: 1,1,1,1
            size_hint: 1, None
            height: dp(64)
            halign: "left"
            pos_hint: {"center_y": .5}

        MDIconButton:
            icon: app.play_pause_icon
            pos_hint: {"center_x": .5, "center_y": .5}
            on_release: app.play_pause()
            theme_icon_color: "Custom"
            icon_color: 1,1,1,1

        MDIconButton:
            icon: "skip-next"
            pos_hint: {"center_x": .5, "center_y": .5}
            on_release: app.next()
            theme_icon_color: "Custom"
            icon_color: 1,1,1,1

    MDProgressBar:
        id: progress_bar
        value: app.progress_bar_value
        color: (1, 1, 1, 1)
        size_hint: 1, None
        height: dp(3)
#-------------------------------------------------------------------------------------------------------
<ExpansedMusicPlayer>
    orientation: "vertical"
    md_bg_color: app.theme_cls.primary_color
    radius: 10, 10, 0, 0
    padding: dp(6)

    MDBoxLayout:
        adaptive_size: True
        padding: dp(8)
        spacing: dp(8)
        pos_hint: {"center_x": .5, "center_y": .5}

        MDIconButton:
            icon: "chevron-down"
            pos_hint: {"center_x": .5, "center_y": 0.1}
            theme_icon_color: "Custom"
            icon_color: 1,1,1,1
            on_release: app.show_music_player()
    MDSeparator:
        height: dp(2)
    MDLabel:
        text: app.running_song_title
        bold: True
        theme_text_color: "Custom"
        text_color: 1,1,1,1
        size_hint: 1, None
        height: dp(64)
        halign: "center"
        pos_hint: {"center_y": .5}

    MDProgressBar:
        id: progress_bar
        value: app.progress_bar_value
        color: (1, 1, 1, 1)
        size_hint: 1, None
        height: dp(3)

    MDBoxLayout:
        orientation: "horizontal"
        size_hint: 1, None
        height: dp(14)

        MDLabel:
            text: app.left_time
            halign: "left"
            valign: "bottom"
            font_size: sp(12)
            color: 1,1,1,1

        MDLabel:
            text: app.right_time
            halign: "right"
            valign: "bottom"
            font_size: sp(12)
            color: 1,1,1,1

    MDBoxLayout:
        adaptive_size: True
        padding: dp(8)
        spacing: dp(8)
        pos_hint: {"center_x": .5, "center_y": .5}

        MDIconButton:
            icon: "shuffle-variant"
            pos_hint: {"center_x": .5, "center_y": .5}
            theme_icon_color: "Custom"
            icon_color: 1,1,1,1

        MDIconButton:
            icon: "skip-previous"
            pos_hint: {"center_x": .5, "center_y": .5}
            on_release: app.previous()
            theme_icon_color: "Custom"
            icon_color: 1,1,1,1

        MDIconButton:
            icon: app.play_pause_icon
            pos_hint: {"center_x": .5, "center_y": .5}
            on_release: app.play_pause()
            theme_icon_color: "Custom"
            icon_color: 1,1,1,1

        MDIconButton:
            icon: "skip-next"
            pos_hint: {"center_x": .5, "center_y": .5}
            on_release: app.next()
            theme_icon_color: "Custom"
            icon_color: 1,1,1,1

        MDIconButton:
            icon: app.repeat_icon
            pos_hint: {"center_x": .5, "center_y": .5}
            #on_release: app.repeat()
            theme_icon_color: "Custom"
            icon_color: 1,1,1,1
#-------------------------------------------------------------------------------------------------------
<Album>
    size_hint_y: None
    height: dp(70)
    md_bg_color: app.theme_cls.bg_dark
    radius: 5
    elevation: 4

    TwoLineAvatarIconListItem:
        text: f"[b] {root.title} [/b]"
        secondary_text: "Unknown artist"
        pos_hint: {'center_y': .5}
        divider: None
        on_release: app.open_album(root.title)
        
        ImageLeftWidget:
            source: root.album_image
            radius: 5
            on_release: app.open_album(root.title)

        IconRightWidget:
            icon: "dots-vertical"
            on_release: app.show_album_bottom_sheet(root.title)   
#-------------------------------------------------------------------------------------------------------
<Add_Album_Dialog>
    orientation: "vertical"
    spacing: "12dp"
    size_hint_y: None
    height: dp(50)

    MDTextField:
        id: album_name_input
        hint_text: "Album name"
        mode: "rectangle"
        max_text_length: 15
        helper_text: "Enter your album name please"
#-------------------------------------------------------------------------------------------------------
<Item>
    on_release: app.choose_songs(root.text)
    ImageLeftWidget:
        source: root.source
        radius: 5
#-------------------------------------------------------------------------------------------------------
<ItemConfirm>

    CheckboxLeftWidget:
        on_active: app.checkbox_click(self, self.active, root.path)
#-------------------------------------------------------------------------------------------------------
<Title>
    size_hint_y: None
    height: dp(50)
    md_bg_color: app.theme_cls.bg_dark
    radius: 5
    elevation: 4

    OneLineIconListItem:
        text: root.title.split("\\")[-1][:-4]
        pos_hint: {'center_y': .5}
        divider: None
        on_release: app.set_song(root.title)
        
        IconLeftWidget:
            icon: "adjust"
            on_release: app.set_song(root.title)
#-------------------------------------------------------------------------------------------------------
<MDFillRoundFlatButton>
    font_size: sp(18)
    size_hint: .7, .05
    md_bg_color: app.theme_cls.primary_color
    text_color: 1,1,1,1
#-----------------------------------------------------------------------------------------------------
#-------------------------------------------------------------------------------------------------------
MDScreen:
    MDBoxLayout:
        orientation: 'vertical'
        MDTopAppBar:
            md_bg_color: app.bg_color
            specific_text_color: app.text_color
            title: app.toolbar_title
            use_overflow: True
            elevation: 10
            left_action_items: [["arrow-left", lambda x: app.back(app.root.ids.screen_manager.current), "Back"]]
            right_action_items: 
                [
                ["theme-light-dark", lambda x: app.switch_theme(), "Theme"],
                ["dots-vertical", lambda x: app.open_settings(x), "Settings"]
                ]
        MDLabel:

        MDBoxLayout:
            id: music_player
            size_hint: 1, None
            height: dp(67)
            #adaptive_height: True

    MDScreenManager: 
        id: screen_manager
#---------------------------------------- HOME SCREEN --------------------------------------------------
        MDScreen:
            name: "HomeScreen"

            MDBoxLayout:
                orientation: 'vertical'

                MDTopAppBar:
                    md_bg_color: app.bg_color
                    specific_text_color: app.text_color
                    title: "MedMusic"
                    elevation: 10
                    left_action_items: [["play-circle-outline"]]
                    right_action_items: 
                        [
                        ["theme-light-dark", lambda x: app.switch_theme(), "Theme"],
                        ["dots-vertical", lambda x: app.open_settings(x), "Settings"]
                        ]

                MDGridLayout:
                    cols: 1
                    size_hint: 1, .4
                    FitImage:
                        source: "Images/home_screen_wallpaper.jpg"
                        size_hint_y: 1

                MDGridLayout:
                    rows: 7
                    size_hint: 1, .6
                    spacing: 10
                    padding: 30

                    MDGridLayout:
                        rows: 1
                        size_hint: 1, .36

                    MDFillRoundFlatButton:
                        text: "Playlists"
                        pos_hint: {"center_x": .5, "center_y": .5}
                        on_release: 
                            root.ids.screen_manager.current = 'PlaylistsScreen'
                            root.ids.screen_manager.transition.direction = "left"
                            app.toolbar_title = "Playlists"
                            app.first_screen = "PlaylistsScreen"
                            app.show_music_player()

                    MDFillRoundFlatButton:
                        text: "Albums"
                        pos_hint: {"center_x": .5, "center_y": .5}
                        on_release: 
                            root.ids.screen_manager.current = 'AlbumsScreen'
                            root.ids.screen_manager.transition.direction = "left"
                            app.toolbar_title = "Albums"
                            app.first_screen = "AlbumsScreen"
                            app.show_music_player()

                    MDFillRoundFlatButton:
                        text: "Titles"
                        pos_hint: {"center_x": .5, "center_y": .5}
                        on_release: 
                            root.ids.screen_manager.current = 'TitlesScreen'
                            root.ids.screen_manager.transition.direction = "left"
                            app.toolbar_title = "Titles"
                            app.show_music_player()
                            app.create_list_titles()

                    MDFillRoundFlatButton:
                        text: "Converter"
                        pos_hint: {"center_x": .5, "center_y": .5}
                        on_release: 
                            root.ids.screen_manager.current = 'ConverterScreen'
                            root.ids.screen_manager.transition.direction = "left"
                            app.toolbar_title = "Converter"

                    MDGridLayout:
                        rows: 1
                        size_hint: 1, .38

                    MDGridLayout:
                        rows: 1
                        size_hint: 1, .06

                        MDLabel:
                            text: '© IDRISSI Ahmed 2022 / All rights reserved'
                            font_size: sp(12)
                            halign: 'center'


#---------------------------------------- PLAYLISTS SCREEN ---------------------------------------------
        MDScreen:
            name: "PlaylistsScreen"
            id: playlists_screen

            MDBoxLayout:
                orientation: 'vertical'
                
                MDBoxLayout:
                    size_hint_y: None
                    height: dp(64)

                ScrollView:
                    MDGridLayout:
                        cols: 1
                        adaptive_height: True
                        padding: dp(12)
                        spacing: dp(12)

                        MDRoundFlatIconButton:
                            icon: "plus-box-outline"
                            text: "New playlist"
                            line_color: 0,0,0,0
                            halign: "left"
                            theme_text_color: "Custom"
                            text_color: app.theme_cls.opposite_bg_normal
                            theme_icon_color: "Custom"
                            icon_color: app.theme_cls.opposite_bg_normal
                            radius: 10, 0
                            on_release: app.add_playlist()

                        MDGridLayout:
                            id: playlists_box
                            cols: 1
                            adaptive_height: True
                            spacing: dp(12)

                MDBoxLayout:
                    size_hint: 1, None
                    height: dp(67) if app.expansed_music_player == False else dp(180)

#---------------------------------------- SONGS SCREEN ---------------------------------------------
        MDScreen:
            name: "SongsScreen"
            orientation: 'vertical'

            MDBoxLayout:
                orientation: 'vertical'

                MDBoxLayout:
                    size_hint_y: None
                    height: dp(64)

                ScrollView:
                    MDGridLayout:
                        cols: 1
                        adaptive_height: True
                        padding: dp(12)
                        spacing: dp(12)

                        MDGridLayout:
                            size_hint: 1, None
                            cols: 2
                            height: dp(150)
                            spacing: dp(8)
                                                    
                            FitImage:
                                id: playlist_image_container
                                source: app.image
                                size_hint_y: 1
                                radius: 10

                            MDBoxLayout:
                                orientation: "vertical"
                                padding: dp(12)
                                MDLabel:
                                    text: app.current_playlist
                                    bold: True
                                    pos_hint: {"center_y":.5}
                                MDLabel:
                                    text: f"Playlist • {app.songs_number} songs"
                                    font_size: sp(10)
                                    pos_hint: {"center_y":.5}
                                MDBoxLayout:
                                    MDIconButton:
                                        icon: "pencil-outline"
                                        pos_hint: {"center_x":.5, "center_y":.5}
                                        on_release: app.rename_playlist()
                                        disabled: True if app.first_screen == "AlbumsScreen" else False
                                    MDIconButton:
                                        icon: "dots-vertical"
                                        pos_hint: {"center_x":.5, "center_y":.5}
                                        on_release: app.show_playlist_bottom_sheet(app.current_playlist)
                        MDBoxLayout:
                            id: songs_container
                            orientation: "vertical"
                            adaptive_height: True
                            spacing: dp(8)

                MDBoxLayout:
                    size_hint: 1, None
                    height: dp(67) if app.expansed_music_player == False else dp(180)

#------------------------------------------ ALBUMS SCREEN ----------------------------------------------
        MDScreen:
            name: "AlbumsScreen"
            id: albums_screen
            MDBoxLayout:
                orientation: 'vertical'

                MDBoxLayout:
                    size_hint_y: None
                    height: dp(64)

                ScrollView:
                    MDGridLayout:
                        cols: 1
                        adaptive_height: True
                        padding: dp(12)
                        spacing: dp(12)

                        MDRoundFlatIconButton:
                            icon: "plus-box-outline"
                            text: "New album"
                            size_hint: 1,1
                            line_color: 0,0,0,0
                            halign: "left"
                            theme_text_color: "Custom"
                            text_color: app.theme_cls.opposite_bg_normal
                            theme_icon_color: "Custom"
                            icon_color: app.theme_cls.opposite_bg_normal
                            radius: 10, 0
                            on_release: app.open_albums_file_manager()

                        MDBoxLayout:
                            id: albums_box
                            orientation: "vertical"
                            adaptive_height: True
                            spacing: dp(8)
                
                MDBoxLayout:
                    size_hint: 1, None
                    height: dp(67) if app.expansed_music_player == False else dp(180)

#------------------------------------------ TITLES SCREEN ----------------------------------------------                                        
        MDScreen:
            name: "TitlesScreen"
            id: titles_screen

            MDBoxLayout:
                orientation: 'vertical'

                MDBoxLayout:
                    size_hint_y: None
                    height: dp(64)

                ScrollView:
                    MDGridLayout:
                        cols: 1
                        adaptive_height: True
                        padding: dp(12)
                        spacing: dp(12)

                        MDBoxLayout:
                            id: titles_box
                            orientation: "vertical"
                            adaptive_height: True
                            spacing: dp(8)

                MDBoxLayout:
                    size_hint: 1, None
                    height: dp(67) if app.expansed_music_player == False else dp(180)                        

#------------------------------------------ CONVERTER SCREEN ----------------------------------------------       
        MDScreen:
            name: "ConverterScreen"
            id: converter_screen
            MDBoxLayout:
                orientation: 'vertical'

                MDBoxLayout:
                    size_hint_y: None
                    height: dp(64)

                MDBoxLayout:
                    orientation: 'vertical'
                    padding: dp(20)
                    spacing: dp(6)

                    MDLabel:
                        text: "Convert videos from YouTube into MP3 and other formats"
                        pos_hint: {"center_x": .5, "center_y": .5}

                    MDTextField:
                        id: link_input
                        hint_text: 'Enter the URL :'
                        text: "https://www.youtube.com/watch?v=XoX6zS5-jOY&list=PL6NdkXsPL07IOu1AZ2Y2lGNYfjDStyT6O&index=4"
                        #"Ex: https://www.youtube.com/watch?v=..."
                        mode: "rectangle"
                        font_size: sp(14)
                        
                    
                    MDBoxLayout:
                        orientation: "vertical"
                        padding: dp(20)

                        MDLabel:
                            text: "Formats"

                        MDGridLayout:
                            cols: 2
                            spacing: dp(6)

                            MDLabel:
                                text: ".mp3"
                                size_hint_x: .8
                            MDCheckbox:
                                group: "formats"
                                size_hint_x: .2

                            MDLabel:
                                text: ".wav"
                                size_hint_x: .8
                            MDCheckbox:
                                group: "formats"
                                size_hint_x: .2


                    MDFillRoundFlatButton:
                        text: app.convert_download_statue
                        size_hint: None, None
                        pos_hint: {"center_x": .5, "center_y": .5}
                        on_release: app.convert_download_music()

                    MDLabel:

#----------------------------------------------------------------------------------------------------------
    
        